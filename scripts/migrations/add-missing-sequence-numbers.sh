#!/bin/bash

# Add missing sequence numbers to all migration files
set -e

cd "$(dirname "$0")/../.."

echo "ðŸ”§ Adding missing sequence numbers to migration files..."

# Legacy files (001-013) - convert to timestamped format with sequence numbers
git mv supabase/migrations/001_initial_schema.sql supabase/migrations/20240101000001_001_initial_schema.sql
git mv supabase/migrations/002_add_is_active_to_bank_accounts.sql supabase/migrations/20240101000002_002_add_is_active_to_bank_accounts.sql  
git mv supabase/migrations/003_add_balance_fields_to_bank_accounts.sql supabase/migrations/20240101000003_003_add_balance_fields_to_bank_accounts.sql
git mv supabase/migrations/004_add_gl_account_relationship_to_bank_accounts.sql supabase/migrations/20240101000004_004_add_gl_account_relationship_to_bank_accounts.sql
git mv supabase/migrations/005_cleanup_bank_accounts_table.sql supabase/migrations/20240101000005_005_cleanup_bank_accounts_table.sql
git mv supabase/migrations/006_update_gl_accounts_field_mapping.sql supabase/migrations/20240101000006_006_update_gl_accounts_field_mapping.sql
git mv supabase/migrations/007_add_building_name_to_units.sql supabase/migrations/20240101000007_007_add_building_name_to_units.sql
git mv supabase/migrations/008_standardize_timestamp_fields.sql supabase/migrations/20240101000008_008_standardize_timestamp_fields.sql
git mv supabase/migrations/009_update_units_country_to_text.sql supabase/migrations/20240101000009_009_update_units_country_to_text.sql
git mv supabase/migrations/010_create_countries_enum.sql supabase/migrations/20240101000010_010_create_countries_enum.sql
git mv supabase/migrations/011_apply_countries_enum_to_tables.sql supabase/migrations/20240101000011_011_apply_countries_enum_to_tables.sql
git mv supabase/migrations/012_add_buildium_property_id_to_lease.sql supabase/migrations/20240101000012_012_add_buildium_property_id_to_lease.sql
git mv supabase/migrations/013_add_buildium_unit_id_to_lease.sql supabase/migrations/20240101000013_013_add_buildium_unit_id_to_lease.sql

# Legacy files (044-045) - these are out of sequence, need to be renumbered
git mv supabase/migrations/044_add_vacant_units_count_to_properties.sql supabase/migrations/20240101000044_014_add_vacant_units_count_to_properties.sql
git mv supabase/migrations/045_fix_properties_updated_at_default.sql supabase/migrations/20240101000045_015_fix_properties_updated_at_default.sql

# Files missing sequence numbers - add them in chronological order
git mv supabase/migrations/20250103000000_fix_property_unit_counts.sql supabase/migrations/20250103000000_016_fix_property_unit_counts.sql
git mv supabase/migrations/20250103000001_remove_vacant_units_count.sql supabase/migrations/20250103000001_017_remove_vacant_units_count.sql
git mv supabase/migrations/20250826233007_add_sub_accounts_to_gl_accounts.sql supabase/migrations/20250826233007_018_add_sub_accounts_to_gl_accounts.sql
git mv supabase/migrations/20250828032609_add_data_integrity_functions.sql supabase/migrations/20250828032609_019_add_data_integrity_functions.sql
git mv supabase/migrations/20250828054100_rename_transactions_columns_to_snake_case.sql supabase/migrations/20250828054100_020_rename_transactions_columns_to_snake_case.sql
git mv supabase/migrations/20250828054110_rename_staff_and_lease_columns_to_snake_case.sql supabase/migrations/20250828054110_021_rename_staff_and_lease_columns_to_snake_case.sql
git mv supabase/migrations/20250828060000_non_destructive_remote_alignment.sql supabase/migrations/20250828060000_022_non_destructive_remote_alignment.sql
git mv supabase/migrations/20250828063500_cleanup_timestamp_standardization.sql supabase/migrations/20250828063500_023_cleanup_timestamp_standardization.sql
git mv supabase/migrations/20250828070000_add_missing_updated_at_triggers.sql supabase/migrations/20250828070000_024_add_missing_updated_at_triggers.sql
git mv supabase/migrations/20250828070500_staged_country_enum_constraints_and_report.sql supabase/migrations/20250828070500_025_staged_country_enum_constraints_and_report.sql
git mv supabase/migrations/20250828073000_normalize_countries_and_convert_to_enum.sql supabase/migrations/20250828073000_026_normalize_countries_and_convert_to_enum.sql
git mv supabase/migrations/20250828134000_add_buildium_lease_id_to_transactions.sql supabase/migrations/20250828134000_027_add_buildium_lease_id_to_transactions.sql
git mv supabase/migrations/20250828143500_add_payment_method_enum_and_alter_transactions.sql supabase/migrations/20250828143500_028_add_payment_method_enum_and_alter_transactions.sql
git mv supabase/migrations/20250828143600_drop_buildium_journal_id_from_transaction_lines.sql supabase/migrations/20250828143600_029_drop_buildium_journal_id_from_transaction_lines.sql

echo "âœ… Added sequence numbers to legacy and missing files!"
