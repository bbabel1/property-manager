---
description: Guidelines for integrating with Buildium API, including authentication, rate limiting, response validation, and relationship handling
globs: ["src/lib/buildium-*.ts", "scripts/**/*buildium*.ts"]
alwaysApply: true
---

Buildium Integration Rules:

1. **Use live database for inspection**: Always query the live Supabase database when 
   inspecting data to avoid confusion with local database state.

2. **Test with real API responses**: Always test mappers and functions with actual 
   Buildium API responses, not just type definitions from src/types/buildium.ts.

3. **Handle API limitations**: Implement proper rate limiting, pagination, and error 
   handling for all Buildium API calls.

4. **Log appropriately**: Log actionable context for debugging, but never log secrets, 
   API keys, or personally identifiable information (PII).

5. **Validate responses**: Always validate Buildium API responses before processing 
   to ensure data integrity and prevent runtime errors.

6. **Use proper authentication**: Ensure all Buildium API calls use the correct 
   authentication headers and credentials from environment variables.

7. **Handle relationship resolution**: When dealing with related data (e.g., 
   properties with bank accounts), use systematic resolution patterns with proper 
   error handling.

8. **Document field mappings**: Maintain clear documentation of field mappings 
   between Buildium API responses and local database schema.

9. **Use direct API calls**: Always use direct API calls with client credentials, 
   not MCP tools or other intermediaries.

10. **Standard API call pattern**:
    ```typescript
    const response = await fetch(`${process.env.BUILDIUM_BASE_URL}/[endpoint]/[id]`, {
      method: 'GET',
      headers: {
        'x-buildium-client-id': process.env.BUILDIUM_CLIENT_ID!,
        'x-buildium-client-secret': process.env.BUILDIUM_CLIENT_SECRET!,
        'Content-Type': 'application/json',
        'Accept': 'application/json'
      }
    })
    ```

11. **Quick script creation**: Use existing scripts in scripts/buildium/sync/ as templates
    and modify for specific entities and IDs.

12. **Environment loading**: Always use dotenv.config({ path: '.env.local' }) in scripts
    to ensure proper environment variable loading.
